#!/bin/bash
echo "Starting blockdx"

echo "Waiting for blocknetdxd to launch on 41414..."
chown -R blocknet:blocknet /home/blocknet
chown -R blocknet:blocknet /home/blocknet/.config

while ! nc -z localhost 41414; do
  echo "Wating for port 41414 to be ready"
  sleep 10 # wait for 1 second before trying again
done

echo "blocknetdxd found!"
echo "Setting username: $BLOCKNETDX_RPC_USER and password: $BLOCKNETDX_RPC_PASSWORD"
sed -i "s/{{BLOCKNETDX_RPC_USER}}/$BLOCKNETDX_RPC_USER/g" /home/blocknet/.config/BLOCK-DX/app-meta.json
sed -i "s/{{BLOCKNETDX_RPC_PASSWORD}}/$BLOCKNETDX_RPC_PASSWORD/g" /home/blocknet/.config/BLOCK-DX/app-meta.json

#curl --data-binary '{"jsonrpc":"1.0","id":"curltext","method":"getblockchaininfo","params":[]}' -H 'content-type:text/plain;' http://test:1234@172.17.0.4:8332/
#curl --data-binary '{"jsonrpc":"1.0","id":"curltext","method":"getaccountaddress","params":["myaccount"]}' -H 'content-type:text/plain;' http://test:1234@10.135.41.201:30253/

sleep 20

exec gosu blocknet block-dx
